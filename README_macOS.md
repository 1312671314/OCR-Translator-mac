# Game-Changing Translator - macOS 使用指南

这是一个实时屏幕文字识别和翻译工具，特别适合游戏字幕、视频字幕的实时翻译。

## 系统要求

- macOS 10.14 或更高版本
- Python 3.11 或更高版本
- 4GB RAM（推荐 8GB）

## 安装步骤

### 1. 安装 Homebrew（如果还没有）

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

### 2. 安装 Tesseract OCR

```bash
brew install tesseract
```

验证安装：
```bash
which tesseract
# 应该输出：/opt/homebrew/bin/tesseract (Apple Silicon)
# 或：/usr/local/bin/tesseract (Intel Mac)
```

### 3. 安装 Python 依赖

```bash
# 创建虚拟环境（推荐）
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### 4. 授予屏幕录制权限

**重要：** macOS 需要授予屏幕录制权限才能截图。

1. 打开 **系统设置** → **隐私与安全性** → **屏幕录制**
2. 找到 **Terminal**（或你使用的终端应用）
3. 勾选启用
4. **重启终端应用**

如果使用 VS Code 或其他 IDE 运行：
- 在屏幕录制列表中找到对应的应用并启用
- 重启该应用

## 启动应用

```bash
# 激活虚拟环境（如果使用）
source venv/bin/activate

# 运行应用
python main.py
```

## 快速上手

### 第一步：配置 Tesseract 路径

1. 切换到 **"设置"** 标签页
2. 找到 **"Tesseract 路径"** 输入框
3. 填入（根据你的 Mac 类型）：
   - Apple Silicon (M1/M2/M3): `/opt/homebrew/bin/tesseract`
   - Intel Mac: `/usr/local/bin/tesseract`
4. 点击 **"立即保存设置"**

### 第二步：选择识别区域

1. 回到 **"主页"** 标签页
2. 点击 **"选择源区域 (OCR)"** 按钮
3. 屏幕会变暗，鼠标变成十字光标 ➕
4. **按住鼠标左键拖动**，框选要识别文字的区域
   - 例如：游戏字幕出现的位置
   - 或者：视频播放器的字幕区域
5. 松开鼠标，会弹出确认对话框

### 第三步：选择翻译显示区域

1. 点击 **"选择目标区域 (翻译)"** 按钮
2. 同样拖动鼠标框选一个区域
3. 这是翻译结果显示的位置
   - 建议选择屏幕上方或侧边不遮挡内容的地方

### 第四步：开始翻译

1. 点击 **"开始"** 按钮
2. 应用会自动：
   - 每隔一段时间截取源区域的图像
   - 识别文字（OCR）
   - 翻译文字
   - 在目标区域显示翻译结果

## 翻译模型选择

### 离线翻译（免费）

**MarianMT**
- ✅ 完全离线，无需 API 密钥
- ✅ 免费使用
- ⚠️ 首次使用会下载模型（约 300MB）
- ⚠️ 翻译质量中等

在设置中选择：
- 翻译模型：**MarianMT（离线且免费）**
- MarianMT 模型：选择语言对（如 English to Chinese）

### 在线翻译（推荐）

#### 1. Gemini API（推荐）

- ✅ 翻译质量优秀
- ✅ 支持上下文翻译
- ✅ 免费额度很大
- ✅ 成本低（约 $0.00004/次）

**获取 API 密钥：**
1. 访问 [Google AI Studio](https://aistudio.google.com/app/apikey)
2. 登录 Google 账号
3. 点击 "Create API Key"
4. 复制 API 密钥

**配置：**
1. 设置 → OCR 模型：**Gemini API（在线）**
2. 设置 → 翻译模型：**Gemini API**
3. 填入 **Gemini API 密钥**
4. 设置源语言和目标语言
5. 保存设置

#### 2. DeepL API

- ✅ 翻译质量最高
- ✅ 支持上下文翻译
- ⚠️ 免费额度有限（50万字符/月）

**获取 API 密钥：**
1. 访问 [DeepL API](https://www.deepl.com/pro-api)
2. 注册免费账号
3. 获取 API 密钥

**配置：**
1. 设置 → 翻译模型：**DeepL API**
2. 填入 **DeepL API 密钥**
3. 保存设置

#### 3. OpenAI API

- ✅ 翻译质量优秀
- ✅ 支持 OCR 和翻译
- ⚠️ 需要付费

## 界面语言

应用支持三种界面语言：
- **English**（英语）
- **polski**（波兰语）
- **简体中文**

在主页顶部的 **"界面语言"** 下拉菜单中选择。

## 常见问题

### 1. 提示 "Source area overlay missing"

**原因：** 没有选择源区域或目标区域

**解决：**
1. 点击 "选择源区域 (OCR)"
2. 拖动鼠标框选区域
3. 点击 "选择目标区域 (翻译)"
4. 拖动鼠标框选区域
5. 再点击 "开始"

### 2. 截图失败或黑屏

**原因：** 没有授予屏幕录制权限

**解决：**
1. 系统设置 → 隐私与安全性 → 屏幕录制
2. 启用 Terminal 或你使用的应用
3. **重启终端/应用**

### 3. OCR 识别不准确

**解决方案：**

**方案 A：调整图像预处理**
1. 设置 → 图像预处理模式
2. 尝试不同模式：
   - **无**：适合清晰文字
   - **二值化**：适合低对比度
   - **自适应**：适合复杂背景

**方案 B：使用 Gemini OCR**
1. 设置 → OCR 模型：**Gemini API（在线）**
2. 填入 Gemini API 密钥
3. Gemini OCR 对复杂字体和背景的识别效果更好

### 4. 翻译速度慢

**优化建议：**
1. 增加扫描间隔：设置 → 扫描间隔（毫秒）→ 改为 500-1000
2. 使用 Gemini 2.5 Flash-Lite 模型（速度快）
3. 启用文件缓存（减少重复翻译）

### 5. 选择区域时看不到矩形框

**原因：** macOS 的 Canvas 渲染问题

**说明：**
- 屏幕会变暗（黑色半透明）
- 鼠标会变成十字光标
- 拖动完成后会弹出确认对话框
- 即使看不到矩形框，选择仍然有效

**改善方法：**
- 在设置中修改源区域颜色为更鲜艳的颜色（如红色 `#FF0000`）

### 6. 启动时下载大量文件

**原因：** 首次使用 MarianMT 模型时会下载

**说明：**
- 只在第一次使用时下载
- 文件会缓存在 `~/.cache/huggingface/`
- 下次启动不会再下载

**避免方法：**
- 使用在线翻译服务（Gemini/DeepL）
- 不选择 MarianMT 模型

## 使用技巧

### 1. 游戏字幕翻译

1. 启动游戏（窗口模式或无边框窗口）
2. 选择字幕出现的区域作为源区域
3. 选择屏幕上方作为目标区域
4. 开始翻译
5. 游戏中的字幕会实时翻译显示

### 2. 视频字幕翻译

1. 播放视频
2. 框选字幕区域
3. 框选显示区域
4. 开始翻译

### 3. 网页/文档翻译

1. 打开网页或文档
2. 框选要翻译的文字区域
3. 框选显示区域
4. 开始翻译

### 4. 隐藏/显示窗口

- 点击 **"隐藏/显示源窗口"** - 切换黄色识别框的显示
- 点击 **"隐藏/显示翻译窗口"** - 切换翻译结果窗口的显示

### 5. 调整窗口

翻译窗口可以：
- **拖动**：点击顶部边缘拖动
- **调整大小**：拖动边框或角落
- **调整透明度**：设置 → 不透明度

## 性能优化

### 减少 API 成本

1. **启用文件缓存**
   - 设置 → 文件缓存选项
   - 勾选对应服务的缓存选项
   - 相同文字不会重复调用 API

2. **调整扫描间隔**
   - 设置 → 扫描间隔（毫秒）
   - 增加间隔可减少 API 调用

3. **使用上下文窗口**
   - Gemini/DeepL 的上下文功能
   - 提高翻译质量但不增加成本

### 提高识别速度

1. 减小源区域大小（只框选字幕部分）
2. 使用 Gemini 2.5 Flash-Lite 模型
3. 降低图像预处理复杂度

## API 使用统计

在 **"API 使用情况"** 标签页可以查看：
- OCR 调用次数和成本
- 翻译调用次数和成本
- 总成本估算
- 导出统计报告

## 卸载

```bash
# 删除虚拟环境
rm -rf venv

# 删除缓存的模型（可选）
rm -rf ~/.cache/huggingface/

# 删除配置文件（可选）
rm ocr_translator_config.ini
rm translator_debug.log
```

## 故障排除

### 查看日志

```bash
tail -f translator_debug.log
```

### 重置配置

```bash
rm ocr_translator_config.ini
python main.py
```

### 清除缓存

主页 → 点击 **"清除翻译缓存"**

## 技术支持

- 原项目：[OCR-Translator](https://github.com/tomkam1702/OCR-Translator)
- macOS 适配问题：查看本文档或提交 Issue

## 许可证

本项目基于 GNU General Public License v3.0 (GPLv3) 开源。

---

**提示：** 首次使用建议先用简单的网页文字测试，熟悉操作流程后再用于游戏或视频。

**推荐配置：**
- OCR：Gemini API（识别准确）
- 翻译：Gemini API 或 DeepL（质量好）
- 扫描间隔：300-500ms（平衡速度和准确性）
- 启用文件缓存（节省成本）
